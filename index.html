<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>Praia Mole Hotel - Mapa Interativo</title>
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<!-- Leaflet Routing Machine CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.css" />
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600&display=swap');
  
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
  
  body, html {
    height: 100%;
    width: 100%;
    font-family: 'Montserrat', sans-serif;
    background: linear-gradient(135deg, #1a2e45 0%, #2c4a6e 50%, #E3B62E 100%);
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #ffffff;
    overflow: hidden;
    position: fixed;
  }
  
  .header {
    text-align: center;
    padding: 15px 10px;
    width: 100%;
    background: rgba(26, 46, 69, 0.95);
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    border-bottom: 3px solid #E3B62E;
    position: relative;
    flex-shrink: 0;
    z-index: 1000;
  }
  
  .header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #E3B62E, #f7d154, #E3B62E);
  }
  
  h1 {
    margin: 0;
    color: #ffffff;
    font-family: 'Playfair Display', serif;
    font-weight: 600;
    font-size: 1.5rem;
    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    letter-spacing: 0.5px;
    line-height: 1.2;
  }
  
  .subtitle {
    margin: 5px 0 0;
    font-size: 0.8rem;
    color: #f7d154;
    font-weight: 300;
    letter-spacing: 0.3px;
  }
  
  .map-container {
    width: 100%;
    height: 100%;
    position: relative;
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }
  
  #map {
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }
  
  /* CONTROLES MOBILE OTIMIZADOS */
  .mobile-controls {
    position: absolute;
    bottom: 20px;
    right: 15px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  
  .mobile-btn {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: rgba(26, 46, 69, 0.95);
    backdrop-filter: blur(15px);
    border: 2px solid #E3B62E;
    color: #f7d154;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
  }
  
  .mobile-btn:active {
    transform: scale(0.95);
    background: rgba(44, 74, 110, 0.95);
  }
  
  .legend-mobile {
    position: absolute;
    top: 15px;
    left: 15px;
    right: 15px;
    background: rgba(26, 46, 69, 0.95);
    backdrop-filter: blur(15px);
    padding: 15px;
    border-radius: 15px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
    font-size: 14px;
    color: #ffffff;
    font-weight: 500;
    z-index: 1000;
    border: 2px solid rgba(227, 182, 46, 0.4);
    max-height: 40vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
  }
  
  .legend-mobile h4 {
    margin: 0 0 12px 0;
    font-weight: 600;
    color: #f7d154;
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    border-bottom: 2px solid #E3B62E;
    padding-bottom: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .legend-content-mobile {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }
  
  .legend-paragraph-mobile h5 {
    color: #f7d154;
    margin-bottom: 8px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    border-bottom: 1px solid rgba(227, 182, 46, 0.3);
    padding-bottom: 4px;
  }
  
  .legend-item-mobile {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    transition: all 0.2s ease;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 8px;
  }
  
  .legend-item-mobile:active {
    transform: translateX(5px);
    background: rgba(227, 182, 46, 0.2);
  }
  
  .legend-icon-mobile {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    margin-right: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 11px;
    color: white;
    font-weight: bold;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
    flex-shrink: 0;
  }
  
  .minimize-btn-mobile {
    background: none;
    border: none;
    color: #f7d154;
    font-size: 1.2rem;
    cursor: pointer;
    padding: 0;
    width: 24px;
    height: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.2s ease;
  }
  
  .legend-icon-mobile.restaurante { background: linear-gradient(135deg, #3498db, #2980b9); }
  .legend-icon-mobile.piscina { background: linear-gradient(135deg, #2ecc71, #27ae60); }
  .legend-icon-mobile.recepcao { background: linear-gradient(135deg, #9b59b6, #8e44ad); }
  .legend-icon-mobile.cabanas { background: linear-gradient(135deg, #f39c12, #e67e22); }
  .legend-icon-mobile.solar { background: linear-gradient(135deg, #1abc9c, #16a085); }
  .legend-icon-mobile.lagoa { background: linear-gradient(135deg, #34495e, #2c3e50); }
  .legend-icon-mobile.acesso { background: linear-gradient(135deg, #e67e22, #d35400); }
  .legend-icon-mobile.campo { background: linear-gradient(135deg, #e84393, #fd79a8); }
  .legend-icon-mobile.tenis { background: linear-gradient(135deg, #00b894, #00cec9); }
  
  /* PAINEL MOBILE */
  .info-panel-mobile {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 70vh;
    background: rgba(26, 46, 69, 0.98);
    backdrop-filter: blur(20px);
    box-shadow: 0 -8px 30px rgba(0, 0, 0, 0.5);
    border-top: 3px solid #E3B62E;
    transform: translateY(100%);
    transition: transform 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    z-index: 10000;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border-radius: 20px 20px 0 0;
  }
  
  .info-panel-mobile.active {
    transform: translateY(0);
  }
  
  .panel-overlay-mobile {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(0, 0, 0, 0.6);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 9999;
  }
  
  .panel-overlay-mobile.active {
    opacity: 1;
    visibility: visible;
  }
  
  .panel-header-mobile {
    padding: 20px 20px 15px;
    border-bottom: 2px solid rgba(227, 182, 46, 0.3);
    background: rgba(44, 74, 110, 0.6);
    display: flex;
    justify-content: space-between;
    align-items: center;
    position: relative;
  }
  
  .panel-header-mobile::after {
    content: '';
    position: absolute;
    bottom: -12px;
    left: 50%;
    transform: translateX(-50%);
    width: 40px;
    height: 4px;
    background: rgba(227, 182, 46, 0.5);
    border-radius: 2px;
  }
  
  .panel-title-mobile {
    font-family: 'Playfair Display', serif;
    font-size: 1.3rem;
    font-weight: 600;
    color: #f7d154;
    margin: 0;
    flex: 1;
  }
  
  .close-panel-mobile {
    background: none;
    border: none;
    color: #f7d154;
    font-size: 1.8rem;
    cursor: pointer;
    padding: 5px;
    border-radius: 50%;
    transition: all 0.2s ease;
    width: 35px;
    height: 35px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
  }
  
  .panel-content-mobile {
    padding: 20px;
    flex-grow: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    color: #ffffff;
  }
  
  .panel-icon-display-mobile {
    text-align: center;
    margin-bottom: 15px;
  }
  
  .panel-icon-large-mobile {
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    font-weight: bold;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
    margin-bottom: 10px;
  }
  
  .info-section-mobile {
    margin-bottom: 15px;
  }
  
  .info-label-mobile {
    font-weight: 600;
    color: #f7d154;
    margin-bottom: 6px;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  .info-content-mobile {
    color: #e8f4f8;
    font-size: 0.9rem;
    line-height: 1.4;
  }
  
  .info-hours-mobile {
    background: rgba(227, 182, 46, 0.1);
    padding: 12px;
    border-radius: 8px;
    border-left: 3px solid #E3B62E;
  }
  
  .info-coordinates-mobile {
    background: rgba(52, 73, 94, 0.3);
    padding: 12px;
    border-radius: 8px;
    font-family: 'Courier New', monospace;
    font-size: 0.8rem;
  }
  
  /* BOT√ïES DE A√á√ÉO MOBILE */
  .action-buttons-mobile {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 15px;
  }
  
  .location-btn-mobile, .navigation-btn-mobile {
    background: linear-gradient(135deg, #E3B62E, #f7d154);
    color: #1a2e45;
    border: none;
    padding: 14px 20px;
    border-radius: 12px;
    font-weight: 600;
    font-size: 0.9rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 4px 15px rgba(227, 182, 46, 0.3);
  }
  
  .navigation-btn-mobile {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
  }
  
  .location-btn-mobile:active, .navigation-btn-mobile:active {
    transform: translateY(2px);
    box-shadow: 0 2px 8px rgba(227, 182, 46, 0.4);
  }
  
  /* INDICADOR DE LOCALIZA√á√ÉO MOBILE */
  .location-indicator-mobile {
    position: absolute;
    top: 80px;
    right: 15px;
    background: rgba(26, 46, 69, 0.95);
    backdrop-filter: blur(15px);
    padding: 12px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
    color: #ffffff;
    font-size: 13px;
    z-index: 1000;
    border: 2px solid rgba(227, 182, 46, 0.4);
    max-width: 200px;
  }
  
  .location-indicator-mobile h4 {
    color: #f7d154;
    margin-bottom: 6px;
    font-size: 0.9rem;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  
  .location-status-mobile {
    display: flex;
    align-items: center;
    gap: 6px;
    margin-bottom: 8px;
  }
  
  .status-dot-mobile {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: #e74c3c;
    flex-shrink: 0;
  }
  
  .status-dot-mobile.active {
    background: #2ecc71;
    animation: pulse 2s infinite;
  }
  
  @keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
  }
  
  .get-location-btn-mobile {
    background: rgba(227, 182, 46, 0.2);
    color: #f7d154;
    border: 1px solid rgba(227, 182, 46, 0.4);
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 0.75rem;
    cursor: pointer;
    transition: all 0.2s ease;
    width: 100%;
  }
  
  .get-location-btn-mobile:active {
    background: rgba(227, 182, 46, 0.3);
  }
  
  /* CONTROLE DE ROTA MOBILE */
  .leaflet-routing-container {
    background: rgba(26, 46, 69, 0.95) !important;
    backdrop-filter: blur(15px);
    border: 2px solid rgba(227, 182, 46, 0.4) !important;
    border-radius: 15px !important;
    color: #ffffff !important;
    font-family: 'Montserrat', sans-serif !important;
    max-height: 40vh !important;
    width: 90vw !important;
    margin: 10px !important;
    font-size: 14px !important;
  }
  
  .leaflet-routing-alt {
    background: transparent !important;
    color: #ffffff !important;
    max-height: 30vh !important;
    overflow-y: auto !important;
  }
  
  .leaflet-routing-alt h2 {
    color: #f7d154 !important;
    font-family: 'Playfair Display', serif !important;
    font-size: 1rem !important;
  }
  
  .leaflet-routing-alt h3 {
    color: #ffffff !important;
    font-size: 0.85rem !important;
  }
  
  .leaflet-routing-alt table {
    color: #e8f4f8 !important;
    font-size: 0.8rem !important;
  }
  
  .leaflet-routing-collapse-btn {
    color: #f7d154 !important;
    font-size: 1.2rem !important;
  }
  
  /* BOT√ÉO DE FULLSCREEN */
  .fullscreen-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    z-index: 1000;
    background: rgba(26, 46, 69, 0.95);
    backdrop-filter: blur(15px);
    border: 2px solid #E3B62E;
    color: #f7d154;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.1rem;
    cursor: pointer;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    transition: all 0.3s ease;
  }
  
  .fullscreen-btn:active {
    transform: scale(0.95);
    background: rgba(44, 74, 110, 0.95);
  }
  
  /* ESTADOS DE ERRO E CARREGAMENTO */
  .loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(26, 46, 69, 0.9);
    backdrop-filter: blur(10px);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    color: #f7d154;
  }
  
  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid rgba(227, 182, 46, 0.3);
    border-top: 4px solid #E3B62E;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-bottom: 20px;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  .error-message {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(231, 76, 60, 0.9);
    color: white;
    padding: 20px;
    border-radius: 15px;
    text-align: center;
    z-index: 1000;
    max-width: 80%;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
  }
  
  .retry-btn {
    background: #E3B62E;
    color: #1a2e45;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    margin-top: 10px;
    font-weight: 600;
    cursor: pointer;
  }
  
  /* OCULTAR ELEMENTOS DO LEAFLET EM MOBILE */
  .leaflet-control-zoom {
    display: none !important;
  }
  
  .leaflet-control-layers {
    display: none !important;
  }
  
  /* SCROLLBAR PERSONALIZADA */
  ::-webkit-scrollbar {
    width: 6px;
  }
  
  ::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
  }
  
  ::-webkit-scrollbar-thumb {
    background: #E3B62E;
    border-radius: 3px;
  }
  
  ::-webkit-scrollbar-thumb:hover {
    background: #f7d154;
  }
</style>
</head>
<body>
  <!-- Tela de Carregamento -->
  <div class="loading-overlay" id="loading-overlay">
    <div class="loading-spinner"></div>
    <p>Carregando mapa...</p>
  </div>

  <div class="header">
    <h1>Praia Mole Hotel</h1>
    <p class="subtitle">Toque nos locais para ver informa√ß√µes e rotas</p>
  </div>
  
  <div class="map-container">
    <div id="map"></div>
    
    <!-- Bot√£o Fullscreen -->
    <button class="fullscreen-btn" id="fullscreen-btn" title="Tela Cheia">‚õ∂</button>
    
    <!-- Legenda Mobile -->
    <div class="legend-mobile" id="legend-mobile">
      <h4>Pontos do Hotel
        <button class="minimize-btn-mobile" id="minimize-btn-mobile" title="Minimizar">‚àí</button>
      </h4>
      <div class="legend-content-mobile">
        <div class="legend-paragraph-mobile">
          <h5>Comodidades</h5>
          <div class="legend-item-mobile" data-type="restaurante"><div class="legend-icon-mobile restaurante">R</div>Restaurante</div>
          <div class="legend-item-mobile" data-type="piscina"><div class="legend-icon-mobile piscina">P</div>Piscina</div>
          <div class="legend-item-mobile" data-type="recepcao"><div class="legend-icon-mobile recepcao">R</div>Recep√ß√£o</div>
          <div class="legend-item-mobile" data-type="cabanas"><div class="legend-icon-mobile cabanas">C</div>Cabanas</div>
        </div>
        <div class="legend-paragraph-mobile">
          <h5>√Åreas</h5>
          <div class="legend-item-mobile" data-type="solar"><div class="legend-icon-mobile solar">S</div>Solar</div>
          <div class="legend-item-mobile" data-type="lagoa"><div class="legend-icon-mobile lagoa">L</div>Lagoa</div>
          <div class="legend-item-mobile" data-type="acesso"><div class="legend-icon-mobile acesso">A</div>Acesso Praia</div>
          <div class="legend-item-mobile" data-type="campo"><div class="legend-icon-mobile campo">C</div>Campo</div>
        </div>
      </div>
    </div>
    
    <!-- Indicador de Localiza√ß√£o Mobile -->
    <div class="location-indicator-mobile" id="location-indicator-mobile">
      <h4>üìç Sua Localiza√ß√£o</h4>
      <div class="location-status-mobile">
        <div class="status-dot-mobile" id="status-dot-mobile"></div>
        <span id="location-text-mobile">Toque para ativar</span>
      </div>
      <button class="get-location-btn-mobile" id="get-location-btn-mobile">Obter Localiza√ß√£o</button>
    </div>
    
    <!-- Controles Mobile -->
    <div class="mobile-controls">
      <button class="mobile-btn" id="location-btn-mobile" title="Minha Localiza√ß√£o">üìç</button>
      <button class="mobile-btn" id="legend-toggle-btn" title="Legenda">üìã</button>
      <button class="mobile-btn" id="recenter-btn" title="Centralizar">üéØ</button>
    </div>
  </div>

  <!-- Painel de Informa√ß√µes Mobile -->
  <div class="panel-overlay-mobile" id="panel-overlay-mobile"></div>
  
  <div class="info-panel-mobile" id="info-panel-mobile">
    <div class="panel-header-mobile">
      <h3 class="panel-title-mobile" id="panel-title-mobile">Informa√ß√µes</h3>
      <button class="close-panel-mobile" id="close-panel-mobile" title="Fechar">√ó</button>
    </div>
    <div class="panel-content-mobile" id="panel-content-mobile">
      <!-- Conte√∫do ser√° inserido dinamicamente -->
    </div>
  </div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<!-- Leaflet Routing Machine -->
<script src="https://unpkg.com/leaflet-routing-machine/dist/leaflet-routing-machine.js"></script>

<script>
  // Detectar se √© mobile
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
  
  // Configura√ß√µes iniciais
  const mapCenter = [-27.6018, -48.4375];
  const bounds = L.latLngBounds(
    L.latLng(-27.6035, -48.4420),
    L.latLng(-27.5995, -48.4340)
  );

  // Vari√°veis globais
  let map, currentPonto, userLocation, userMarker, userCircle, routingControl;
  let isFullscreen = false;
  let mapInitialized = false;

  // Elementos da interface
  const elements = {
    loadingOverlay: document.getElementById('loading-overlay'),
    map: document.getElementById('map'),
    legendMobile: document.getElementById('legend-mobile'),
    minimizeBtnMobile: document.getElementById('minimize-btn-mobile'),
    locationIndicatorMobile: document.getElementById('location-indicator-mobile'),
    statusDotMobile: document.getElementById('status-dot-mobile'),
    locationTextMobile: document.getElementById('location-text-mobile'),
    getLocationBtnMobile: document.getElementById('get-location-btn-mobile'),
    locationBtnMobile: document.getElementById('location-btn-mobile'),
    legendToggleBtn: document.getElementById('legend-toggle-btn'),
    recenterBtn: document.getElementById('recenter-btn'),
    fullscreenBtn: document.getElementById('fullscreen-btn'),
    panelMobile: document.getElementById('info-panel-mobile'),
    overlayMobile: document.getElementById('panel-overlay-mobile'),
    panelTitleMobile: document.getElementById('panel-title-mobile'),
    panelContentMobile: document.getElementById('panel-content-mobile'),
    closePanelMobile: document.getElementById('close-panel-mobile')
  };

  // Inicializar mapa com tratamento de erro
  function initializeMap() {
    try {
      map = L.map('map', {
        center: mapCenter,
        zoom: 17,
        zoomControl: false,
        zoomAnimation: true,
        fadeAnimation: true,
        maxZoom: 20,
        minZoom: 16,
        maxBounds: bounds,
        maxBoundsViscosity: 1.0,
        tap: false,
        touchZoom: true,
        scrollWheelZoom: false,
        doubleClickZoom: true,
        boxZoom: false,
        keyboard: false
      });

      // Adicionar camada de sat√©lite
      const arcgisSat = L.tileLayer(
        'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',
        { 
          maxZoom: 20, 
          attribution: 'Tiles &copy; Esri'
        }
      ).addTo(map);

      // Adicionar controle de zoom customizado para mobile
      L.control.zoom({
        position: 'bottomright'
      }).addTo(map);

      mapInitialized = true;
      elements.loadingOverlay.style.display = 'none';
      
      // Adicionar pontos ap√≥s o mapa estar pronto
      setTimeout(addPointsToMap, 100);
      
    } catch (error) {
      console.error('Erro ao inicializar mapa:', error);
      showError('Erro ao carregar o mapa. Tente recarregar a p√°gina.');
    }
  }

  // Mostrar mensagem de erro
  function showError(message) {
    elements.loadingOverlay.style.display = 'none';
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error-message';
    errorDiv.innerHTML = `
      <p>${message}</p>
      <button class="retry-btn" onclick="window.location.reload()">Tentar Novamente</button>
    `;
    document.body.appendChild(errorDiv);
  }

  // Criar √≠cones coloridos
  function createIcon(type) {
    const iconColors = {
      'restaurante': '#3498db', 'piscina': '#2ecc71', 'recepcao': '#9b59b6',
      'cabanas': '#f39c12', 'solar': '#1abc9c', 'lagoa': '#34495e',
      'acesso': '#e67e22', 'campo': '#e84393', 'tenis': '#00b894'
    };
    
    const iconLetters = {
      'restaurante': 'R', 'piscina': 'P', 'recepcao': 'R', 'cabanas': 'C',
      'solar': 'S', 'lagoa': 'L', 'acesso': 'A', 'campo': 'C', 'tenis': 'T'
    };
    
    return L.divIcon({
      className: 'custom-div-icon',
      html: `<div style="background: linear-gradient(135deg, ${iconColors[type]}, ${iconColors[type]}99); width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; border: 3px solid white; box-shadow: 0 4px 10px rgba(0,0,0,0.4); font-size: 14px;">${iconLetters[type]}</div>`,
      iconSize: [36, 36],
      iconAnchor: [18, 18]
    });
  }

  // Adicionar pontos ao mapa
  function addPointsToMap() {
    const pontosInteresse = [
      {
        nome: "Cabanas de Praia",
        tipo: "cabanas",
        coordenadas: [-27.602103, -48.437201],
        descricao: "Cabanas exclusivas para h√≥spedes na beira da praia com vista privilegiada para o mar.",
        horario: "Reserva necess√°ria - 8h √†s 18h"
      },
      {
        nome: "Restaurante Principal",
        tipo: "restaurante",
        coordenadas: [-27.601969, -48.436230],
        descricao: "Desfrute de refei√ß√µes deliciosas com vista para o mar. Culin√°ria internacional e regional.",
        horario: "Caf√©: 7h-10h | Almo√ßo: 12h-15h | Jantar: 19h-22h"
      },
      {
        nome: "Recep√ß√£o",
        tipo: "recepcao",
        coordenadas: [-27.60228, -48.43647],
        descricao: "Central de atendimento 24h para check-in e informa√ß√µes tur√≠sticas.",
        horario: "Atendimento 24 horas"
      },
      {
        nome: "Piscina Externa",
        tipo: "piscina",
        coordenadas: [-27.60194, -48.43586],
        descricao: "Piscina com vista panor√¢mica para o mar. √Årea completa de lazer.",
        horario: "8h √†s 20h - Aquecida"
      },
      {
        nome: "Acesso √† Praia Mole",
        tipo: "acesso",
        coordenadas: [-27.602246, -48.435184],
        descricao: "Acesso direto √† famosa Praia Mole. Trilha pavimentada e segura.",
        horario: "Acesso 24h para h√≥spedes"
      }
    ];

    pontosInteresse.forEach(ponto => {
      const marker = L.marker(ponto.coordenadas, {icon: createIcon(ponto.tipo)})
        .addTo(map);
      
      marker.on('click', () => {
        openInfoPanel(ponto);
      });
    });

    // Adicionar √°rea do hotel
    const hotelArea = L.polygon([
      [-27.601504, -48.439632],
      [-27.601828, -48.435225],
      [-27.602537, -48.435511],
      [-27.602294, -48.439959]
    ], {
      color: '#E3B62E',
      fillColor: '#f9f1d1',
      fillOpacity: 0.2,
      weight: 2
    }).addTo(map).bindPopup('√Årea do Praia Mole Hotel');
  }

  // Obter localiza√ß√£o do usu√°rio
  function getUserLocation() {
    if (!navigator.geolocation) {
      elements.locationTextMobile.textContent = 'GPS n√£o suportado';
      return;
    }

    elements.locationTextMobile.textContent = 'Obtendo...';
    elements.getLocationBtnMobile.disabled = true;

    navigator.geolocation.getCurrentPosition(
      position => {
        userLocation = [position.coords.latitude, position.coords.longitude];
        elements.statusDotMobile.classList.add('active');
        elements.locationTextMobile.textContent = 'Localiza√ß√£o ativa';
        elements.getLocationBtnMobile.textContent = 'Atualizar';
        elements.getLocationBtnMobile.disabled = false;
        updateUserLocationMarker();
        map.setView(userLocation, 16);
      },
      error => {
        console.error('Erro GPS:', error);
        elements.locationTextMobile.textContent = 'Erro de localiza√ß√£o';
        elements.getLocationBtnMobile.disabled = false;
      },
      {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 60000
      }
    );
  }

  // Atualizar marcador do usu√°rio
  function updateUserLocationMarker() {
    if (userMarker) map.removeLayer(userMarker);
    if (userCircle) map.removeLayer(userCircle);
    
    userMarker = L.marker(userLocation, {
      icon: L.divIcon({
        className: 'user-location-marker',
        html: `<div style="background: linear-gradient(135deg, #e74c3c, #c0392b); width: 28px; height: 28px; border-radius: 50%; border: 3px solid white; box-shadow: 0 3px 8px rgba(0,0,0,0.4);"></div>`,
        iconSize: [28, 28],
        iconAnchor: [14, 14]
      })
    }).addTo(map).bindPopup('Sua localiza√ß√£o');
    
    userCircle = L.circle(userLocation, {
      color: '#e74c3c',
      fillColor: '#e74c3c',
      fillOpacity: 0.15,
      radius: 30
    }).addTo(map);
  }

  // Calcular rota
  function calculateRoute(destination) {
    if (!userLocation) {
      alert('Ative sua localiza√ß√£o primeiro.');
      return;
    }
    
    if (routingControl) {
      map.removeControl(routingControl);
    }
    
    routingControl = L.Routing.control({
      waypoints: [
        L.latLng(userLocation[0], userLocation[1]),
        L.latLng(destination[0], destination[1])
      ],
      routeWhileDragging: false,
      showAlternatives: false,
      fitSelectedRoutes: true,
      show: true,
      collapsible: true,
      language: 'pt',
      createMarker: () => null
    }).addTo(map);
    
    closeInfoPanel();
  }

  // Abrir painel de informa√ß√µes
  function openInfoPanel(ponto) {
    currentPonto = ponto;
    elements.panelTitleMobile.textContent = ponto.nome;
    
    const iconColors = {
      'restaurante': '#3498db', 'piscina': '#2ecc71', 'recepcao': '#9b59b6',
      'cabanas': '#f39c12', 'solar': '#1abc9c', 'lagoa': '#34495e',
      'acesso': '#e67e22', 'campo': '#e84393', 'tenis': '#00b894'
    };
    
    const iconLetters = {
      'restaurante': 'R', 'piscina': 'P', 'recepcao': 'R', 'cabanas': 'C',
      'solar': 'S', 'lagoa': 'L', 'acesso': 'A', 'campo': 'C', 'tenis': 'T'
    };
    
    elements.panelContentMobile.innerHTML = `
      <div class="panel-icon-display-mobile">
        <div class="panel-icon-large-mobile" style="background: linear-gradient(135deg, ${iconColors[ponto.tipo]}, ${iconColors[ponto.tipo]}99);">
          ${iconLetters[ponto.tipo]}
        </div>
      </div>
      
      <div class="info-section-mobile">
        <div class="info-label-mobile">Descri√ß√£o</div>
        <div class="info-content-mobile">${ponto.descricao}</div>
      </div>
      
      <div class="info-section-mobile">
        <div class="info-label-mobile">Hor√°rio</div>
        <div class="info-hours-mobile">
          <div class="info-content-mobile">${ponto.horario}</div>
        </div>
      </div>
      
      <div class="action-buttons-mobile">
        <button class="location-btn-mobile" id="location-btn-panel">
          <i>üìç</i> Centralizar no Mapa
        </button>
        <button class="navigation-btn-mobile" id="navigation-btn-panel">
          <i>üöó</i> Tra√ßar Rota
        </button>
      </div>
    `;
    
    document.getElementById('location-btn-panel').addEventListener('click', () => {
      map.setView(ponto.coordenadas, 18, { animate: true, duration: 1.0 });
      closeInfoPanel();
    });
    
    document.getElementById('navigation-btn-panel').addEventListener('click', () => {
      calculateRoute(ponto.coordenadas);
    });
    
    elements.overlayMobile.classList.add('active');
    elements.panelMobile.classList.add('active');
  }

  // Fechar painel
  function closeInfoPanel() {
    elements.panelMobile.classList.remove('active');
    elements.overlayMobile.classList.remove('active');
  }

  // Alternar tela cheia
  function toggleFullscreen() {
    if (!document.fullscreenElement) {
      document.documentElement.requestFullscreen().catch(err => {
        console.error('Erro ao entrar em tela cheia:', err);
      });
      elements.fullscreenBtn.innerHTML = '‚õ∂';
    } else {
      document.exitFullscreen();
      elements.fullscreenBtn.innerHTML = '‚õ∂';
    }
  }

  // Alternar legenda
  function toggleLegend() {
    elements.legendMobile.style.display = elements.legendMobile.style.display === 'none' ? 'block' : 'none';
  }

  // Recentralizar mapa
  function recenterMap() {
    if (userLocation) {
      map.setView(userLocation, 16, { animate: true });
    } else {
      map.setView(mapCenter, 17, { animate: true });
    }
  }

  // Event Listeners
  function setupEventListeners() {
    // Bot√µes de controle
    elements.getLocationBtnMobile.addEventListener('click', getUserLocation);
    elements.locationBtnMobile.addEventListener('click', getUserLocation);
    elements.legendToggleBtn.addEventListener('click', toggleLegend);
    elements.recenterBtn.addEventListener('click', recenterMap);
    elements.fullscreenBtn.addEventListener('click', toggleFullscreen);
    
    // Painel
    elements.closePanelMobile.addEventListener('click', closeInfoPanel);
    elements.overlayMobile.addEventListener('click', closeInfoPanel);
    
    // Legenda
    elements.minimizeBtnMobile.addEventListener('click', () => {
      elements.legendMobile.style.display = 'none';
    });
    
    // Itens da legenda
    document.querySelectorAll('.legend-item-mobile').forEach(item => {
      item.addEventListener('click', function() {
        const tipo = this.getAttribute('data-type');
        // Simular clique no marcador correspondente
        map.eachLayer(layer => {
          if (layer instanceof L.Marker && layer.options.icon?.options?.html?.includes(tipo)) {
            layer.fire('click');
          }
        });
      });
    });
    
    // Tecla ESC para fechar painel
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        closeInfoPanel();
        if (document.fullscreenElement) {
          document.exitFullscreen();
        }
      }
    });
    
    // Redimensionamento
    window.addEventListener('resize', () => {
      if (map) {
        setTimeout(() => map.invalidateSize(), 100);
      }
    });
    
    // Fullscreen change
    document.addEventListener('fullscreenchange', () => {
      isFullscreen = !!document.fullscreenElement;
      setTimeout(() => map.invalidateSize(), 100);
    });
  }

  // Inicializa√ß√£o
  document.addEventListener('DOMContentLoaded', () => {
    initializeMap();
    setupEventListeners();
    
    // Prevenir zoom duplo no mapa
    let lastTouchEnd = 0;
    document.addEventListener('touchend', function (event) {
      const now = (new Date()).getTime();
      if (now - lastTouchEnd <= 300) {
        event.preventDefault();
      }
      lastTouchEnd = now;
    }, false);
  });

  // Recarregar mapa se necess√°rio
  function reloadMap() {
    if (map) {
      map.remove();
    }
    initializeMap();
  }
</script>
</body>
</html>
